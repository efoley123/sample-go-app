name: GoTest test process

on:
  push:
    branches: [main]
  pull_request:

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Test
        run: go test -v ./... | go-junit-report -set-exit-code > report.xml
      - name: Record test results to Launchable workspace
        uses: launchableinc/record-build-and-test-results-action@v1.0.0
        with:
          test_runner: go-test
          report_path: './report.xml'
        if: always()
        env:
          LAUNCHABLE_TOKEN: v1:f991ec0f-0f34-49bc-673c-100d47ea3587/2f336c0b-b12f-4357-b6b4-5271644b1755:88cb4665f5554e7ba1b0a2d9a6e85a9e